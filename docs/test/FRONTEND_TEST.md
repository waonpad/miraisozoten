# ゲーム部分のフロントエンドテストを行う

ひとまず, テスト対象に対して求められている引数の受け渡し, 行動を取ったときに正常に動作する事を確認することを目標とし, その他のテストケースに関しては努力目標とする

テストランナー: [Vitest](https://vitest.dev/guide/)  
APIモック: [msw](https://mswjs.io/)

### テスト対象のファイル一覧

- app/web/src/(todoufuken) 配下の全てのファイル(/\_/api ディレクトリを除く)
- app/web/src/components/maps 配下の全てのファイル(japan-checkbox-svg-map.tsxを除く)

### テストファイルについての規則

- テストファイルは, テスト対象ファイルと同じディレクトリに配置する
- テスト対象ファイルの拡張子の前に.testを付けたものをファイル名とする
- テスト対象ファイルのコードに対するテストは, 全てファイル名で紐付いたテストファイルに記述し, 分割しない
- テストケース名は, <対象の関数名>\_<テストケースの説明>という形式にする. 説明は, 今回はわかりやすさ重視で日本語で記述する
- `'@testing-library/react'` からのimportは, 再exportしている@/test/utilsに置き換える (関数の拡張性を持たせるため)

### テストの事前準備

#### プロダクトのセットアップ手順を一通り行う

docs/SETUP.mdを参照

#### mswを利用するテストを行う場合

```
cd packages/fb-tools
yarn dev
nps firebase.admin
```

### テストを書く

**基本的にテストコードはまずAIによって生成し, 人間はそれに加筆修正を行うことを大前提とする**

全てのファイルのテストが正常に動作するまで, 以下の手順を繰り返す

#### テストコードをAIに生成させる

1. AI自身が優秀な技術者であることを教える
2. テスト対象のコードをコピペする
3. テスト対象が依存しているコードや, 型情報等, 必要な情報を加える
4. 正常系のテストコードの生成を要求する
5. 正常にテスト可能なコードが生成されるまでコードの提供や会話を行う
6. テストファイルの命名規則に則って作成されたファイルに, 生成されたテストコードをコピペする

#### テストを実行する

全てのテストを実行する場合

```
yarn test
```

動作確認のため, 1ファイルだけテストする場合

```
yarn vitest run <テストファイルのパス>
```

#### テストに使われる設定・共通ファイル

vitestの設定は, vite.config.tsに記述されている

```js
// ...
test: {
      globals: true,
      // ...
}
// ...
```

`globals: true` の設定により, テスト用の関数のimportは不要

---

packaes.jsonのtestスクリプトは, --silentオプションによってテスト実行時のコンソール出力を抑制している  
確認が必要な場合, 一時的にオプションを外す等して対応する

---

全てのテストケースにおいて, src/setup-tests.tsが実行される  
`import '@/test/utils/mocks';` の記述により, 全てのテストケースで行う必要のあるモック化が行われる
